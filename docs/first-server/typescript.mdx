---
title: "TypeScript"
description: "15 åˆ†é’Ÿå†…ç”¨ TypeScript åˆ›å»ºä¸€ä¸ªç®€å•çš„ MCP æœåŠ¡å™¨"
---

è®©æˆ‘ä»¬ç”¨ TypeScript æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¤©æ°”æœåŠ¡å™¨ï¼Œå®ƒæä¾›å½“å‰å¤©æ°”æ•°æ®ä½œä¸ºèµ„æºï¼Œå¹¶è®© Claude ä½¿ç”¨å·¥å…·è·å–å¤©æ°”é¢„æŠ¥ã€‚

<Note>
æœ¬æŒ‡å—ä½¿ç”¨ OpenWeatherMap APIã€‚ä½ éœ€è¦ä» [OpenWeatherMap](https://openweathermap.org/api) è·å–ä¸€ä¸ªå…è´¹çš„ API å¯†é’¥æ‰èƒ½ç»§ç»­ã€‚
</Note>

## å‰ææ¡ä»¶

<Steps>
  <Step title="å®‰è£… Node.js">
    ä½ éœ€è¦ Node.js 18 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š
    
    ```bash
    node --version  # åº”ä¸º v18 æˆ–æ›´é«˜ç‰ˆæœ¬
    npm --version
    ```
  </Step>

  <Step title="åˆ›å»ºæ–°é¡¹ç›®">
    ä½ å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„ [create-typescript-server](https://github.com/modelcontextprotocol/create-typescript-server) å·¥å…·æ¥åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›®ï¼š

    ```bash
    npx @modelcontextprotocol/create-server weather-server
    cd weather-server
    ```
  </Step>

  <Step title="å®‰è£…ä¾èµ–">
    ```bash
    npm install --save axios dotenv
    ```
  </Step>

  <Step title="è®¾ç½®ç¯å¢ƒ">
    åˆ›å»º `.env`ï¼š
    ```bash
    OPENWEATHER_API_KEY=ä½ çš„ API å¯†é’¥
    ```
    ç¡®ä¿å°†ç¯å¢ƒæ–‡ä»¶æ·»åŠ åˆ° `.gitignore`
    ```bash
    .env
    ```
  </Step>
</Steps>

## åˆ›å»ºæœåŠ¡å™¨

<Steps>
  <Step title="å®šä¹‰ç±»å‹">
    åˆ›å»ºæ–‡ä»¶ `src/types.ts`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

    ```typescript
    export interface OpenWeatherResponse {
      main: {
        temp: number;
        humidity: number;
      };
      weather: Array<{
        description: string;
      }>;
      wind: {
        speed: number;
      };
      dt_txt?: string;
    }

    export interface WeatherData {
      temperature: number;
      conditions: string;
      humidity: number;
      wind_speed: number;
      timestamp: string;
    }

    export interface ForecastDay {
      date: string;
      temperature: number;
      conditions: string;
    }

    export interface GetForecastArgs {
      city: string;
      days?: number;
    }

    // ç±»å‹å®ˆå«ç”¨äºé¢„æŠ¥å‚æ•°
    export function isValidForecastArgs(args: any): args is GetForecastArgs {
      return (
        typeof args === "object" && 
        args !== null && 
        "city" in args &&
        typeof args.city === "string" &&
        (args.days === undefined || typeof args.days === "number")
      );
    }
    ```
  </Step>

  <Step title="æ·»åŠ åŸºç¡€ä»£ç ">
    ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢ `src/index.ts`ï¼š

    ```typescript
    #!/usr/bin/env node
    import { Server } from "@modelcontextprotocol/sdk/server/index.js";
    import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
    import {
      ListResourcesRequestSchema,
      ReadResourceRequestSchema,
      ListToolsRequestSchema,
      CallToolRequestSchema,
      ErrorCode,
      McpError
    } from "@modelcontextprotocol/sdk/types.js";
    import axios from "axios";
    import dotenv from "dotenv";
    import { 
      WeatherData, 
      ForecastDay, 
      OpenWeatherResponse,
      isValidForecastArgs 
    } from "./types.js";

    dotenv.config();

    const API_KEY = process.env.OPENWEATHER_API_KEY;
    if (!API_KEY) {
      throw new Error("éœ€è¦ OPENWEATHER_API_KEY ç¯å¢ƒå˜é‡");
    }

    const API_CONFIG = {
      BASE_URL: 'http://api.openweathermap.org/data/2.5',
      DEFAULT_CITY: 'æ—§é‡‘å±±',
      ENDPOINTS: {
        CURRENT: 'weather',
        FORECAST: 'forecast'
      }
    } as const;

    class WeatherServer {
      private server: Server;
      private axiosInstance;

      constructor() {
        this.server = new Server({
          name: "example-weather-server",
          version: "0.1.0"
        }, {
          capabilities: {
            resources: {},
            tools: {}
          }
        });

        // é…ç½® axios é»˜è®¤å€¼
        this.axiosInstance = axios.create({
          baseURL: API_CONFIG.BASE_URL,
          params: {
            appid: API_KEY,
            units: "metric"
          }
        });

        this.setupHandlers();
        this.setupErrorHandling();
      }

      private setupErrorHandling(): void {
        this.server.onerror = (error) => {
          console.error("[MCP é”™è¯¯]", error);
        };

        process.on('SIGINT', async () => {
          await this.server.close();
          process.exit(0);
        });
      }

      private setupHandlers(): void {
        this.setupResourceHandlers();
        this.setupToolHandlers();
      }

      private setupResourceHandlers(): void {
        // å®ç°åœ¨ä¸‹ä¸€èŠ‚ç»§ç»­
      }

      private setupToolHandlers(): void {
        // å®ç°åœ¨ä¸‹ä¸€èŠ‚ç»§ç»­
      }

      async run(): Promise<void> {
        const transport = new StdioServerTransport();
        await this.server.connect(transport);
        
        // è™½ç„¶è¿™åªæ˜¯ä¸€æ¡ä¿¡æ¯ï¼Œä½†æˆ‘ä»¬å¿…é¡»è®°å½•åˆ° stderrï¼Œ
        // ä»¥é¿å…å¹²æ‰°åœ¨ stdout ä¸Šè¿›è¡Œçš„ MCP é€šä¿¡
        console.error("å¤©æ°” MCP æœåŠ¡å™¨æ­£åœ¨é€šè¿‡ stdio è¿è¡Œ");
      }
    }

    const server = new WeatherServer();
    server.run().catch(console.error);
    ```
  </Step>

  <Step title="æ·»åŠ èµ„æºå¤„ç†ç¨‹åº">
    å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° `setupResourceHandlers` æ–¹æ³•ä¸­ï¼š

    ```typescript
    private setupResourceHandlers(): void {
      this.server.setRequestHandler(
        ListResourcesRequestSchema,
        async () => ({
          resources: [{
            uri: `weather://${API_CONFIG.DEFAULT_CITY}/current`,
            name: `${API_CONFIG.DEFAULT_CITY}çš„å½“å‰å¤©æ°”`,
            mimeType: "application/json",
            description: "å®æ—¶å¤©æ°”æ•°æ®ï¼ŒåŒ…æ‹¬æ¸©åº¦ã€å¤©æ°”çŠ¶å†µã€æ¹¿åº¦å’Œé£é€Ÿ"
          }]
        })
      );

      this.server.setRequestHandler(
        ReadResourceRequestSchema,
        async (request) => {
          const city = API_CONFIG.DEFAULT_CITY;
          if (request.params.uri !== `weather://${city}/current`) {
            throw new McpError(
              ErrorCode.InvalidRequest,
              `æœªçŸ¥èµ„æºï¼š${request.params.uri}`
            );
          }

          try {
            const response = await this.axiosInstance.get<OpenWeatherResponse>(
              API_CONFIG.ENDPOINTS.CURRENT,
              {
                params: { q: city }
              }
            );

            const weatherData: WeatherData = {
              temperature: response.data.main.temp,
              conditions: response.data.weather[0].description,
              humidity: response.data.main.humidity,
              wind_speed: response.data.wind.speed,
              timestamp: new Date().toISOString()
            };

            return {
              contents: [{
                uri: request.params.uri,
                mimeType: "application/json",
                text: JSON.stringify(weatherData, null, 2)
              }]
            };
          } catch (error) {
            if (axios.isAxiosError(error)) {
              throw new McpError(
                ErrorCode.InternalError,
                `å¤©æ°” API é”™è¯¯ï¼š${error.response?.data.message ?? error.message}`
              );
            }
            throw error;
          }
        }
      );
    }
    ```
  </Step>

  <Step title="æ·»åŠ å·¥å…·å¤„ç†ç¨‹åº">
    å°†ä»¥ä¸‹å¤„ç†ç¨‹åºæ·»åŠ åˆ° `setupToolHandlers` æ–¹æ³•ä¸­ï¼š

    ```typescript
    private setupToolHandlers(): void {
      this.server.setRequestHandler(
        ListToolsRequestSchema,
        async () => ({
          tools: [{
            name: "get_forecast",
            description: "è·å–åŸå¸‚çš„å¤©æ°”é¢„æŠ¥",
            inputSchema: {
              type: "object",
              properties: {
                city: {
                  type: "string",
                  description: "åŸå¸‚åç§°"
                },
                days: {
                  type: "number",
                  description: "å¤©æ•°ï¼ˆ1-5ï¼‰",
                  minimum: 1,
                  maximum: 5
                }
              },
              required: ["city"]
            }
          }]
        })
      );

      this.server.setRequestHandler(
        CallToolRequestSchema,
        async (request) => {
          if (request.params.name !== "get_forecast") {
            throw new McpError(
              ErrorCode.MethodNotFound,
              `æœªçŸ¥å·¥å…·ï¼š${request.params.name}`
            );
          }

          if (!isValidForecastArgs(request.params.arguments)) {
            throw new McpError(
              ErrorCode.InvalidParams,
              "æ— æ•ˆçš„é¢„æŠ¥å‚æ•°"
            );
          }

          const city = request.params.arguments.city;
          const days = Math.min(request.params.arguments.days || 3, 5);

          try {
            const response = await this.axiosInstance.get<{
              list: OpenWeatherResponse[]
            }>(API_CONFIG.ENDPOINTS.FORECAST, {
              params: {
                q: city,
                cnt: days * 8 // API è¿”å› 3 å°æ—¶é—´éš”çš„æ•°æ®
              }
            });

            const forecasts: ForecastDay[] = [];
            for (let i = 0; i < response.data.list.length; i += 8) {
              const dayData = response.data.list[i];
              forecasts.push({
                date: dayData.dt_txt?.split(' ')[0] ?? new Date().toISOString().split('T')[0],
                temperature: dayData.main.temp,
                conditions: dayData.weather[0].description
              });
            }

            return {
              content: [{
                type: "text",
                text: JSON.stringify(forecasts, null, 2)
              }]
            };
          } catch (error) {
            if (axios.isAxiosError(error)) {
              return {
                content: [{
                  type: "text",
                  text: `å¤©æ°” API é”™è¯¯ï¼š${error.response?.data.message ?? error.message}`
                }],
                isError: true,
              }
            }
            throw error;
          }
        }
      );
    }
    ```
  </Step>

  <Step title="æ„å»ºå’Œæµ‹è¯•">
    ```bash
    npm run build
    ```
  </Step>
</Steps>

## è¿æ¥åˆ° Claude Desktop

<Steps>
  <Step title="æ›´æ–° Claude é…ç½®">
    å¦‚æœä½ åœ¨é¡¹ç›®è®¾ç½®æœŸé—´æ²¡æœ‰è¿æ¥åˆ° Claude Desktopï¼Œè¯·åœ¨ `claude_desktop_config.json` ä¸­æ·»åŠ ï¼š

    ```json
    {
      "mcpServers": {
        "weather": {
          "command": "node",
          "args": ["/path/to/weather-server/build/index.js"],
          "env": {
            "OPENWEATHER_API_KEY": "ä½ çš„ API å¯†é’¥",
          }
        }
      }
    }
    ```
  </Step>

  <Step title="é‡å¯ Claude">
    1. å®Œå…¨é€€å‡º Claude
    2. é‡æ–°å¯åŠ¨ Claude
    3. åœ¨ ğŸ”Œ èœå•ä¸­æŸ¥æ‰¾ä½ çš„å¤©æ°”æœåŠ¡å™¨
  </Step>
</Steps>

## è¯•ä¸€è¯•ï¼

<AccordionGroup>
  <Accordion title="æŸ¥çœ‹å½“å‰å¤©æ°”" active>
    é—® Claudeï¼š
    ```
    æ—§é‡‘å±±ç°åœ¨çš„å¤©æ°”å¦‚ä½•ï¼Ÿä½ èƒ½åˆ†æä¸€ä¸‹å¤©æ°”çŠ¶å†µå—ï¼Ÿ
    ```
  </Accordion>

  <Accordion title="è·å–å¤©æ°”é¢„æŠ¥">
    é—® Claudeï¼š
    ```
    ä½ èƒ½ç»™æˆ‘ä¸€ä¸ªä¸œäº¬çš„ 5 å¤©å¤©æ°”é¢„æŠ¥ï¼Œå‘Šè¯‰æˆ‘æ˜¯å¦éœ€è¦å¸¦ä¼å—ï¼Ÿ
    ```
  </Accordion>

  <Accordion title="æ¯”è¾ƒå¤©æ°”">
    é—® Claudeï¼š
    ```
    ä½ èƒ½åˆ†æä¸€ä¸‹ä¸œäº¬å’Œæ—§é‡‘å±±çš„å¤©æ°”é¢„æŠ¥ï¼Œå‘Šè¯‰æˆ‘æœ¬å‘¨å“ªä¸ªåŸå¸‚ä¼šæ›´æš–å’Œå—ï¼Ÿ
    ```
  </Accordion>
</AccordionGroup>

## ç†è§£ä»£ç 

<Tabs>
  <Tab title="ç±»å‹å®‰å…¨">
    ```typescript
    interface WeatherData {
      temperature: number;
      conditions: string;
      humidity: number;
      wind_speed: number;
      timestamp: string;
    }
    ```
    TypeScript ä¸ºæˆ‘ä»¬çš„ MCP æœåŠ¡å™¨å¢åŠ äº†ç±»å‹å®‰å…¨æ€§ï¼Œä½¿å…¶æ›´å¯é ä¸”æ˜“äºç»´æŠ¤ã€‚
  </Tab>

  <Tab title="èµ„æº">
    ```typescript
    this.server.setRequestHandler(
      ListResourcesRequestSchema,
      async () => ({
        resources: [{
          uri: `weather://${DEFAULT_CITY}/current`,
          name: `${DEFAULT_CITY}çš„å½“å‰å¤©æ°”`,
          mimeType: "application/json"
        }]
      })
    );
    ```
    èµ„æºæä¾› Claude å¯ä»¥ä½œä¸ºä¸Šä¸‹æ–‡è®¿é—®çš„æ•°æ®ã€‚
  </Tab>

  <Tab title="å·¥å…·">
    ```typescript
    {
      name: "get_forecast",
      description: "è·å–åŸå¸‚çš„å¤©æ°”é¢„æŠ¥",
      inputSchema: {
        type: "object",
        properties: {
          city: { type: "string" },
          days: { type: "number" }
        }
      }
    }
    ```
    å·¥å…·è®© Claude èƒ½å¤Ÿé€šè¿‡ä½ çš„æœåŠ¡å™¨ä½¿ç”¨ç±»å‹å®‰å…¨çš„è¾“å…¥æ‰§è¡Œæ“ä½œã€‚
  </Tab>
</Tabs>

## æœ€ä½³å®è·µ

<CardGroup cols={1}>
  <Card
    title="é”™è¯¯å¤„ç†"
    icon="shield"
  >
    å½“å·¥å…·é‡åˆ°é”™è¯¯æ—¶ï¼Œè¿”å›å¸¦æœ‰ `isError: true` çš„é”™è¯¯æ¶ˆæ¯ï¼Œä»¥ä¾¿æ¨¡å‹å¯ä»¥è‡ªæˆ‘çº æ­£ï¼š

    ```typescript
    try {
      const response = await axiosInstance.get(...);
    } catch (error) {
      if (axios.isAxiosError(error)) {
        return {
          content: {
            mimeType: "text/plain",
            text: `å¤©æ°” API é”™è¯¯ï¼š${error.response?.data.message ?? error.message}`
          },
          isError: true,
        }
      }
      throw error;
    }
    ```

    å¯¹äºå…¶ä»–å¤„ç†ç¨‹åºï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥é€šçŸ¥ç”¨æˆ·ï¼š

    ```typescript
    try {
      const response = await this.axiosInstance.get(...);
    } catch (error) {
      if (axios.isAxiosError(error)) {
        throw new McpError(
          ErrorCode.InternalError,
          `å¤©æ°” API é”™è¯¯ï¼š${error.response?.data.message}`
        );
      }
      throw error;
    }
    ```
  </Card>

  <Card title="ç±»å‹éªŒè¯"
    icon="check"
  >
    ```typescript
    function isValidForecastArgs(args: any): args is GetForecastArgs {
      return (
        typeof args === "object" && 
        args !== null && 
        "city" in args &&
        typeof args.city === "string"
      );
    }
    ```

    <Tip>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨åƒ [Zod](https://zod.dev/) è¿™æ ·çš„åº“æ¥è‡ªåŠ¨æ‰§è¡Œæ­¤éªŒè¯ã€‚</Tip>
  </Card>
</CardGroup>

## å¯ç”¨ä¼ è¾“

è™½ç„¶æœ¬æŒ‡å—ä½¿ç”¨ stdio å°† MCP æœåŠ¡å™¨ä½œä¸ºæœ¬åœ°è¿›ç¨‹è¿è¡Œï¼Œä½† MCP ä¹Ÿæ”¯æŒå…¶ä»–[ä¼ è¾“](/docs/concepts/transports)ã€‚

## æ•…éšœæ’é™¤

<Info>
  ä»¥ä¸‹æ•…éšœæ’é™¤æç¤ºé€‚ç”¨äº macOSã€‚å…¶ä»–å¹³å°çš„æŒ‡å—å³å°†æ¨å‡ºã€‚
</Info>

### æ„å»ºé”™è¯¯
```bash
# æ£€æŸ¥ TypeScript ç‰ˆæœ¬
npx tsc --version

# æ¸…ç†å¹¶é‡æ–°æ„å»º
rm -rf build/
npm run build
```

### è¿è¡Œæ—¶é”™è¯¯
åœ¨ Claude Desktop æ—¥å¿—ä¸­æŸ¥æ‰¾è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯ï¼š
```bash
# ç›‘æ§æ—¥å¿—
tail -n 20 -f ~/Library/Logs/Claude/mcp*.log
```

### ç±»å‹é”™è¯¯
```bash
# ä¸æ„å»ºçš„æƒ…å†µä¸‹æ£€æŸ¥ç±»å‹
npx tsc --noEmit
```

## ä¸‹ä¸€æ­¥

<CardGroup cols={2}>
  <Card
    title="æ¶æ„æ¦‚è¿°"
    icon="sitemap"
    href="/docs/concepts/architecture"
  >
    äº†è§£æ›´å¤šå…³äº MCP æ¶æ„çš„ä¿¡æ¯
  </Card>

  <Card
    title="TypeScript SDK"
    icon="square-js"
    href="https://github.com/modelcontextprotocol/typescript-sdk"
  >
    åœ¨ GitHub ä¸ŠæŸ¥çœ‹ TypeScript SDK
  </Card>
</CardGroup>

<Note>
éœ€è¦å¸®åŠ©ï¼Ÿé—®é—® Claudeï¼ç”±äºå®ƒå¯ä»¥è®¿é—® MCP SDK æ–‡æ¡£ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ è°ƒè¯•é—®é¢˜å¹¶å»ºè®®æ”¹è¿›ä½ çš„æœåŠ¡å™¨ã€‚
</Note>